"use strict";(()=>{var e={};e.id=946,e.ids=[946],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1821:(e,o,t)=>{t.r(o),t.d(o,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>p,staticGenerationAsyncStorage:()=>g});var r={};t.r(r),t.d(r,{GET:()=>u,POST:()=>l});var n=t(9303),s=t(8716),i=t(3131),a=t(7070),c=t(6039);async function l(e){try{let{movieTitle:o,showDate:t,showTime:r,screen:n,seats:s,totalPrice:i,customerName:l,customerEmail:u,customerPhone:d}=await e.json();if(!o||!t||!r||!n||!s||!Array.isArray(s)||0===s.length||!i||!l||!u||!d)return a.NextResponse.json({error:"Missing required fields. Please fill all details."},{status:400});try{let e=await (0,c.s)(),m={movieTitle:o,showDate:t,showTime:r,screen:n,seats:s,totalPrice:i,customerName:l,customerEmail:u,customerPhone:d,createdAt:new Date},g={id:(await e.insertOne(m)).insertedId.toString(),...m};return a.NextResponse.json({success:!0,booking:g},{status:201})}catch(c){console.error("MongoDB error:",c);let e=c?.message||String(c);if(e.includes("MONGODB_URI")||e.includes("Missing")||e.includes("connection")||e.includes("connect")){console.warn("MongoDB connection issue. Booking will be saved but may not persist.");let e={id:`booking-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,movieTitle:o,showDate:t,showTime:r,screen:n,seats:s,totalPrice:i,customerName:l,customerEmail:u,customerPhone:d,createdAt:new Date().toISOString()};return a.NextResponse.json({success:!0,booking:e,warning:"Database not connected. Booking saved temporarily."},{status:201})}throw c}}catch(o){console.error("Booking POST error:",o);let e=o?.message||"Failed to create booking. Please try again.";return a.NextResponse.json({error:e},{status:500})}}async function u(e){try{let{searchParams:o}=new URL(e.url),t=o.get("email"),r=(await (0,c.s)()).find(t?{customerEmail:t}:{}).sort({createdAt:-1}).project({movieTitle:1,showDate:1,showTime:1,screen:1,seats:1,totalPrice:1,customerName:1,customerEmail:1,customerPhone:1,createdAt:1}),n=(await r.toArray()).map(e=>({id:e._id?.toString()??"",movieTitle:e.movieTitle,showDate:e.showDate,showTime:e.showTime,screen:e.screen,seats:e.seats,totalPrice:e.totalPrice,customerName:e.customerName,customerEmail:e.customerEmail,customerPhone:e.customerPhone,createdAt:e.createdAt}));return a.NextResponse.json({bookings:n})}catch(e){return console.error("Booking GET error:",e),a.NextResponse.json({error:"Failed to load bookings"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/bookings/route",pathname:"/api/bookings",filename:"route",bundlePath:"app/api/bookings/route"},resolvedPagePath:"C:\\Users\\ASUS\\OneDrive\\Desktop\\awp mini proj\\app\\api\\bookings\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:p}=d,h="/api/bookings/route";function w(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:g})}},6039:(e,o,t)=>{t.d(o,{s:()=>l});let r=require("mongodb"),n=process.env.MONGODB_URI,s=process.env.MONGODB_DB??"awp-mini-proj",i=null;if(!n)throw Error("Missing MONGODB_URI environment variable. Please add it to your Vercel environment variables or .env.local file.");let a={maxPoolSize:1,minPoolSize:1,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,connectTimeoutMS:1e4,retryWrites:!0,retryReads:!0,directConnection:!1,compressors:["zlib"]};if(!global._mongoClientPromise){let e=new r.MongoClient(n,a);global._mongoClientPromise=e.connect().then(e=>e).catch(e=>{global._mongoClientPromise=null;let o=e.message||String(e);if(o.includes("authentication")||o.includes("credentials"))throw Error("MongoDB authentication failed. Check your username and password.");if(o.includes("ENOTFOUND")||o.includes("getaddrinfo"))throw Error("Cannot reach MongoDB server. Check your network and cluster address.");if(o.includes("timeout"))throw Error("Connection timeout. Check MongoDB Atlas IP whitelist (allow 0.0.0.0/0 for Vercel).");throw Error(`MongoDB connection failed: ${o}`)})}async function c(){i||(i=new r.MongoClient(n,a).connect());try{return await i}catch(e){throw global._mongoClientPromise=null,e}}async function l(){try{let e=(await c()).db(s).collection("bookings");if(!global._mongoIndexCreated)try{await e.createIndex({createdAt:-1},{background:!0}),global._mongoIndexCreated=!0}catch(e){e.message?.includes("already exists")||e.message?.includes("IndexOptionsConflict")||console.warn("Index creation warning:",e.message),global._mongoIndexCreated=!0}return e}catch(e){throw console.error("MongoDB collection error:",e),Error(`Database operation failed: ${e.message||"Unknown error"}`)}}i=global._mongoClientPromise}};var o=require("../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),r=o.X(0,[276,972],()=>t(1821));module.exports=r})();